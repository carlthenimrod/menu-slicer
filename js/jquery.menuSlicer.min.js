(function(b,p){function j(a,c){this.subMenuTimer=this.subMenuActive=this.animating=this.active=!1;this.menuItems=b(a).children("li");this.element=a;this.config=b.extend({},q,c);this.init()}var q={subMenuAnimation:"fade",subMenuAnimationSpeed:200,subMenuCloseSpeed:200,menuClass:"ms-menu",moreMenuClass:"ms-more-menu",moreLinkClass:"ms-more-link",subMenuClass:"ms-sub-menu",minWidth:!1,maxWidth:!1,sliceMethod:"height",whiteList:!1};j.prototype.init=function(){var a=this;b(a.element).addClass(a.config.menuClass);
a.buildMenu();b(p).on("resize",function(){a.buildMenu()});b("."+a.config.menuClass).on("click","."+a.config.moreLinkClass,function(b){a.subMenuDisplay(b)});b("."+a.config.menuClass).on("mouseenter","."+a.config.moreMenuClass,function(){a.subMenuMouseOver()});b("."+a.config.menuClass).on("mouseleave","."+a.config.moreMenuClass,function(){a.subMenuMouseLeave()})};j.prototype.buildMenu=function(){this.setWidth();this.setHeight();"width"===this.config.sliceMethod?this.config.maxWidth&&this.config.containerWidth>
this.config.maxWidth?this.active&&this.resetMenu():this.config.minWidth&&this.config.containerWidth<this.config.minWidth?this.active&&this.resetMenu():this.createMenu():this.createMenu();this.subMenuActive&&this.subMenuClose()};j.prototype.createMenu=function(){var a=b(this.element),c=this.menuItems,d=[],d=0,f,h;a.empty();f=b("<li>",{"class":this.config.moreMenuClass});h=b("<a/>",{href:"#",alt:"More...",title:"More...","class":this.config.moreLinkClass,html:"More..."});f.append(h);if("width"===this.config.sliceMethod)a.append(f),
d+=f.outerWidth(),f.remove(),d=this.config.whiteList?this.sortWhiteList(c,f,d):this.sortWidth(c,d),0<d.length&&this.createSubMenu(d,f),this.active=!0;else{var g,e=b("<div/>",{style:"clear: both;"}),d=0;for(h=c.length;d<h;++d)if(a.append(c[d]),a.append(e),g=a.height(),e.remove(),g>this.elementHeight){d=this.config.whiteList?this.sortWhiteList(c,f):this.sortList(c,f);0<d.length&&this.createSubMenu(d,f);break}}};j.prototype.resetMenu=function(){var a=b(this.element),c=this.menuItems,d,f;a.empty();d=
0;for(f=c.length;d<f;++d)a.append(c[d]);this.active=!1};j.prototype.subMenuDisplay=function(a){this.subMenuActive?this.subMenuClose():this.subMenuOpen();a.preventDefault()};j.prototype.subMenuShow=function(){"fade"===this.config.subMenuAnimation?(b("."+this.config.subMenuClass).stop(),b("."+this.config.subMenuClass).css({display:"block",opacity:1}),this.subMenuActive=!0,this.animating=!1):"slide"===this.config.subMenuAnimation&&(b("."+this.config.subMenuClass).stop(),b("."+this.config.subMenuClass).css({height:"",
"margin-top":"","margin-bottom":"",overflow:"","padding-top":"","padding-bottom":""}),this.subMenuActive=!0,this.animating=!1)};j.prototype.subMenuOpen=function(){var a=this,c=b.Deferred();a.animating||(a.animating=!0,"fade"===a.config.subMenuAnimation?b("."+a.config.subMenuClass).css({display:"block",opacity:"0"}).animate({opacity:1},a.config.subMenuAnimationSpeed,function(){c.resolve()}):"slide"===a.config.subMenuAnimation?b("."+a.config.subMenuClass).slideToggle(a.config.subMenuAnimationSpeed,
function(){c.resolve()}):(b("."+a.config.subMenuClass).css("display","block"),c.resolve()),c.done(function(){a.subMenuActive=!0;a.animating=!1}))};j.prototype.subMenuClose=function(){var a=this,c=b.Deferred();a.animating||(a.animating=!0,"fade"===a.config.subMenuAnimation?b("."+a.config.subMenuClass).animate({opacity:0},a.config.subMenuAnimationSpeed,function(){b(this).css("display","none");c.resolve()}):"slide"===a.config.subMenuAnimation?b("."+a.config.subMenuClass).slideToggle(a.config.subMenuAnimationSpeed,
function(){c.resolve()}):(b("."+a.config.subMenuClass).css("display","none"),c.resolve()),c.done(function(){a.subMenuActive=!1;a.animating=!1}))};j.prototype.subMenuMouseOver=function(){this.subMenuTimer&&clearTimeout(this.subMenuTimer);this.subMenuActive?this.subMenuShow():this.subMenuOpen()};j.prototype.subMenuMouseLeave=function(){var a=this;a.subMenuTimer=setTimeout(function(){a.subMenuClose()},a.config.subMenuCloseSpeed)};j.prototype.setWidth=function(){this.config.containerWidth=b(this.element).width()};
j.prototype.setHeight=function(){var a=b(this.element),c=b("<div/>",{style:"clear: both;"});a.empty();a.append(this.menuItems.first());a.append(c);this.elementHeight=a.height();c.remove();this.resetMenu()};j.prototype.sortList=function(a,c){var d=b(this.element),f=[],h,g=b("<div/>",{style:"clear: both;"}),e,k;d.empty();e=0;for(k=a.length;e<k;++e)d.append(a[e]),d.append(c),d.append(g),h=d.height(),g.remove(),c.remove(),h>this.elementHeight&&(b(a[e]).remove(),f.push(a[e]));return f};j.prototype.sortWhiteList=
function(a,c,d){var f=b(this.element);a=this.menuItems;var h=this.config.whiteList,g=[],e,k,j,n;f.empty();k=0;for(j=a.length;k<j;++k){e=!1;for(n in h)h[n]===a[k].id&&(e=!0);if(e)if(f.append(a[k]),"width"===this.config.sliceMethod)d+=b(a[k]).outerWidth(!0),d>=this.config.containerWidth&&(b(a[k]).remove(),d-=b(a[k]).outerWidth(!0),g.push(a[k]));else{var l=b("<div/>",{style:"clear: both;"});f.append(c);f.append(l);e=f.height();l.remove();b(c).remove();if(e>this.elementHeight&&(b(a[k]).remove(),g.push(a[k]),
e=b(a[k]).children("ul"),e=e.clone(),0<e.length)){e=e.find("li");for(var m=l=void 0,l=0,m=e.length;l<m;++l)g.push(e[l])}}else if(g.push(a[k]),e=b(a[k]).children("ul"),e=e.clone(),0<e.length){e=e.find("li");m=l=void 0;l=0;for(m=e.length;l<m;++l)g.push(e[l])}}return g};j.prototype.sortWidth=function(a,c){var d=b(this.element),f=[],h,g,e;g=0;for(e=a.length;g<e;++g)if(d.append(a[g]),c+=b(a[g]).outerWidth(!0),c>=this.config.containerWidth&&(b(a[g]).remove(),c-=b(a[g]).outerWidth(!0),f.push(a[g]),h=b(a[g]).children("ul"),
h=h.clone(),0<h.length)){h=h.find("li");for(var k=void 0,j=void 0,k=0,j=h.length;k<j;++k)f.push(h[k])}return f};j.prototype.createSubMenu=function(a,c){var d=b(this.element),f,h,g;f=b("<ul>",{"class":this.config.subMenuClass});h=0;for(g=a.length;h<g;++h)f.append(a[h]);c.append(f);d.append(c)};b.fn.menuSlicer=function(a){return this.each(function(){new j(this,a)})}})(jQuery,window);